id_distrito_federal, distrito_federal,
pan:total_votos_asentado) %>%
# Crear claves de match
mutate(id_entidad = sprintf("%02d", id_entidad),
id_end_dist = paste0(id_entidad, id_distrito_federal)) %>%
# Hacer colúmna por partido
pivot_longer(pan:nulos,
names_to = "partido",
values_to = "votos") %>%
# Aglutinar votos por partido
mutate(partido_asgn = case_when(str_detect(partido,
"morena|pt|pvem") &
id_end_dist %in% dto_shh ~ "pvem_pt_morena",
str_detect(partido,
"pan|pri|prd") &
id_end_dist %in% dto_fcm ~ "pan_prd_pri",
T ~ partido),
votos = as.numeric(votos),
total_votos_asentado = as.numeric(total_votos_asentado)) %>%
# group_by(id_entidad, id_distrito_federal) %>%
left_join(asig,
join_by(id_end_dist, partido_asgn)) %>%
# mutate(partido_coal = if)
group_by(partido_asgn) %>%
summarise(total_votos_asentado = first(total_votos_asentado, na_rm = T),
votos = sum(as.numeric(votos), na.rm = T)) %>%
adorn_totals()
View(a)
a <- prep_dip %>%
# Remover votos no contados para MR
filter(tipo_acta != "4ERP",
contabilizada == 1) %>%
# Seleccionar datos importantes
select(clave_casilla,
id_entidad, entidad,
id_distrito_federal, distrito_federal,
pan:total_votos_asentado) %>%
# Crear claves de match
mutate(id_entidad = sprintf("%02d", id_entidad),
id_end_dist = paste0(id_entidad, id_distrito_federal)) %>%
# Hacer colúmna por partido
pivot_longer(pan:nulos,
names_to = "partido",
values_to = "votos") %>%
# Aglutinar votos por partido
mutate(partido_asgn = case_when(str_detect(partido,
"morena|pt|pvem") &
id_end_dist %in% dto_shh ~ "pvem_pt_morena",
str_detect(partido,
"pan|pri|prd") &
id_end_dist %in% dto_fcm ~ "pan_prd_pri",
T ~ partido),
votos = as.numeric(votos),
total_votos_asentado = as.numeric(total_votos_asentado)) %>%
# group_by(id_entidad, id_distrito_federal) %>%
left_join(asig,
join_by(id_end_dist, partido_asgn)) %>%
# mutate(partido_coal = if)
group_by(partido_coal) %>%
summarise(total_votos_asentado = first(total_votos_asentado, na_rm = T),
votos = sum(as.numeric(votos), na.rm = T)) %>%
adorn_totals()
View(a)
a <- prep_dip %>%
# Remover votos no contados para MR
filter(tipo_acta != "4ERP",
contabilizada == 1) %>%
# Seleccionar datos importantes
select(clave_casilla,
id_entidad, entidad,
id_distrito_federal, distrito_federal,
pan:total_votos_asentado) %>%
# Crear claves de match
mutate(id_entidad = sprintf("%02d", id_entidad),
id_end_dist = paste0(id_entidad, id_distrito_federal)) %>%
# Hacer colúmna por partido
pivot_longer(pan:nulos,
names_to = "partido",
values_to = "votos") %>%
# Aglutinar votos por partido
mutate(partido_asgn = case_when(str_detect(partido,
"morena|pt|pvem") &
id_end_dist %in% dto_shh ~ "pvem_pt_morena",
str_detect(partido,
"pan|pri|prd") &
id_end_dist %in% dto_fcm ~ "pan_prd_pri",
T ~ partido),
votos = as.numeric(votos),
total_votos_asentado = as.numeric(total_votos_asentado)) %>%
# group_by(id_entidad, id_distrito_federal) %>%
left_join(asig,
join_by(id_end_dist, partido_asgn)) %>%
mutate(partido_coal = ifelse(is.na(partido_coal),
str_to_upper(partido_asgn), partido_coal))
a <- prep_dip %>%
# Remover votos no contados para MR
filter(tipo_acta != "4ERP",
contabilizada == 1) %>%
# Seleccionar datos importantes
select(clave_casilla,
id_entidad, entidad,
id_distrito_federal, distrito_federal,
pan:total_votos_asentado) %>%
# Crear claves de match
mutate(id_entidad = sprintf("%02d", id_entidad),
id_end_dist = paste0(id_entidad, id_distrito_federal)) %>%
# Hacer colúmna por partido
pivot_longer(pan:nulos,
names_to = "partido",
values_to = "votos") %>%
# Aglutinar votos por partido
mutate(partido_asgn = case_when(str_detect(partido,
"morena|pt|pvem") &
id_end_dist %in% dto_shh ~ "pvem_pt_morena",
str_detect(partido,
"pan|pri|prd") &
id_end_dist %in% dto_fcm ~ "pan_prd_pri",
T ~ partido),
votos = as.numeric(votos),
total_votos_asentado = as.numeric(total_votos_asentado)) %>%
# group_by(id_entidad, id_distrito_federal) %>%
left_join(asig,
join_by(id_end_dist, partido_asgn)) %>%
mutate(partido_coal = ifelse(is.na(partido_coal),
str_to_upper(partido_asgn), partido_coal)) %>%
group_by(partido_coal) %>%
summarise(total_votos_asentado = first(total_votos_asentado, na_rm = T),
votos = sum(as.numeric(votos), na.rm = T)) %>%
adorn_totals()
View(a)
a <- prep_dip %>%
# Remover votos no contados para MR
filter(tipo_acta != "4ERP",
contabilizada == 1) %>%
# Seleccionar datos importantes
select(clave_casilla,
id_entidad, entidad,
id_distrito_federal, distrito_federal,
pan:total_votos_asentado) %>%
# Crear claves de match
mutate(id_entidad = sprintf("%02d", id_entidad),
id_end_dist = paste0(id_entidad, id_distrito_federal)) %>%
# Hacer colúmna por partido
pivot_longer(pan:nulos,
names_to = "partido",
values_to = "votos") %>%
# Aglutinar votos por partido
mutate(partido_asgn = case_when(str_detect(partido,
"morena|pt|pvem") &
id_end_dist %in% dto_shh ~ "pvem_pt_morena",
str_detect(partido,
"pan|pri|prd") &
id_end_dist %in% dto_fcm ~ "pan_prd_pri",
T ~ partido),
votos = as.numeric(votos),
total_votos_asentado = as.numeric(total_votos_asentado)) %>%
# group_by(id_entidad, id_distrito_federal) %>%
left_join(asig,
join_by(id_end_dist, partido_asgn)) %>%
mutate(partido_coal = ifelse(is.na(partido_coal),
str_to_upper(partido_asgn), str_to_upper(partido_coal))) %>%
group_by(partido_coal) %>%
summarise(total_votos_asentado = first(total_votos_asentado, na_rm = T),
votos = sum(as.numeric(votos), na.rm = T)) %>%
adorn_totals()
View(a)
a <- prep_dip %>%
# Remover votos no contados para MR
filter(#tipo_acta != "4ERP",
contabilizada == 1) %>%
# Seleccionar datos importantes
select(clave_casilla,
id_entidad, entidad,
id_distrito_federal, distrito_federal,
pan:total_votos_asentado) %>%
# Crear claves de match
mutate(id_entidad = sprintf("%02d", id_entidad),
id_end_dist = paste0(id_entidad, id_distrito_federal)) %>%
# Hacer colúmna por partido
pivot_longer(pan:nulos,
names_to = "partido",
values_to = "votos") %>%
# Aglutinar votos por partido
mutate(partido_asgn = case_when(str_detect(partido,
"morena|pt|pvem") &
id_end_dist %in% dto_shh ~ "pvem_pt_morena",
str_detect(partido,
"pan|pri|prd") &
id_end_dist %in% dto_fcm ~ "pan_prd_pri",
T ~ partido),
votos = as.numeric(votos),
total_votos_asentado = as.numeric(total_votos_asentado)) %>%
# group_by(id_entidad, id_distrito_federal) %>%
left_join(asig,
join_by(id_end_dist, partido_asgn)) %>%
mutate(partido_coal = ifelse(is.na(partido_coal),
str_to_upper(partido_asgn), str_to_upper(partido_coal))) %>%
group_by(partido_coal) %>%
summarise(total_votos_asentado = first(total_votos_asentado, na_rm = T),
votos = sum(as.numeric(votos), na.rm = T)) %>%
adorn_totals()
View(a)
dto_fcm
dto_fcm
asig <- read_xlsx("04_datos_generados/Convenios de coalición - Diputados federales y senado - AYT.xlsx",
skip = 1) %>%
clean_names() %>%
pivot_longer(c(asignacion_coalicion_shh_morena_pt_pvem,
asignacion_fcm),
names_to = "partido_asgn",
values_to = "partido_coal") %>%
transmute(id_end_dist = paste0(ent_to_id(estado), sprintf("%03d", distrito)),
partido_asgn = case_match(partido_asgn,
"asignacion_coalicion_shh_morena_pt_pvem" ~ "pvem_pt_morena",
"asignacion_fcm" ~ "pan_prd_pri"),
partido_coal) %>%
filter(!is.na(partido_coal))
dto_fcm
candi_dip
dto_fcm
candi_dip
View(cat_dip)
View(candi_dip)
asig <- read_xlsx("04_datos_generados/Convenios de coalición - Diputados federales y senado - AYT.xlsx",
skip = 1) %>%
clean_names() %>%
pivot_longer(c(asignacion_coalicion_shh_morena_pt_pvem,
asignacion_fcm),
names_to = "partido_asgn",
values_to = "partido_coal") %>%
transmute(id_end_dist = paste0(ent_to_id(estado), sprintf("%03d", distrito)),
partido_asgn = case_match(partido_asgn,
"asignacion_coalicion_shh_morena_pt_pvem" ~ "pvem_pt_morena",
"asignacion_fcm" ~ "pan_prd_pri"),
partido_coal) %>%
filter(!is.na(partido_coal))
dto_shh <- candi_dip %>%
filter(partido_ci == "pvem_pt_morena") %>%
pull(id_end_dist)
dto_fcm <- candi_dip %>%
filter(partido_ci == "pan_prd_pri") %>%
pull(id_end_dist)
a <- prep_dip %>%
# Remover votos no contados para MR
filter(#tipo_acta != "4ERP",
contabilizada == 1) %>%
# Seleccionar datos importantes
select(clave_casilla,
id_entidad, entidad,
id_distrito_federal, distrito_federal,
pan:total_votos_asentado) %>%
# Crear claves de match
mutate(id_entidad = sprintf("%02d", id_entidad),
id_end_dist = paste0(id_entidad, id_distrito_federal)) %>%
# Hacer colúmna por partido
pivot_longer(pan:nulos,
names_to = "partido",
values_to = "votos") %>%
# Aglutinar votos por partido
mutate(partido_asgn = case_when(str_detect(partido,
"morena|pt|pvem") &
id_end_dist %in% dto_shh ~ "pvem_pt_morena",
str_detect(partido,
"pan|pri|prd") &
id_end_dist %in% dto_fcm ~ "pan_prd_pri",
T ~ partido),
votos = as.numeric(votos),
total_votos_asentado = as.numeric(total_votos_asentado)) %>%
# group_by(id_entidad, id_distrito_federal) %>%
left_join(asig,
join_by(id_end_dist, partido_asgn)) %>%
mutate(partido_coal = ifelse(is.na(partido_coal),
str_to_upper(partido_asgn), str_to_upper(partido_coal))) %>%
group_by(partido_coal) %>%
summarise(total_votos_asentado = first(total_votos_asentado, na_rm = T),
votos = sum(as.numeric(votos), na.rm = T)) %>%
adorn_totals()
View(a)
# Procesamiento de datos por distrito ----
rm(a)
sum_dist <- prep_dip %>%
# Remover votos no contados para MR
filter(tipo_acta != "4ERP",
contabilizada == 1) %>%
# Seleccionar datos importantes
select(clave_casilla,
id_entidad, entidad,
id_distrito_federal, distrito_federal,
pan:total_votos_asentado) %>%
# Crear claves de match
mutate(id_entidad = sprintf("%02d", id_entidad),
id_end_dist = paste0(id_entidad, id_distrito_federal)) %>%
# Hacer colúmna por partido
pivot_longer(pan:nulos,
names_to = "partido",
values_to = "votos") %>%
# Aglutinar votos por partido
mutate(partido_asgn = case_when(str_detect(partido,
"morena|pt|pvem") &
id_end_dist %in% dto_shh ~ "pvem_pt_morena",
str_detect(partido,
"pan|pri|prd") &
id_end_dist %in% dto_fcm ~ "pan_prd_pri",
T ~ partido),
votos = as.numeric(votos),
total_votos_asentado = as.numeric(total_votos_asentado)) %>%
# group_by(id_entidad, id_distrito_federal) %>%
left_join(asig,
join_by(id_end_dist, partido_asgn)) %>%
mutate(partido_coal = ifelse(is.na(partido_coal),
str_to_upper(partido_asgn), str_to_upper(partido_coal))) %>%
group_by(partido_coal) %>%
summarise(total_votos_asentado = first(total_votos_asentado, na_rm = T),
votos = sum(as.numeric(votos), na.rm = T)) %>%
adorn_totals()
sum_dist
View(sum_dist)
dto_fcm
asig %>%
filter(partido_asgn == pan_prd_pri)
asig %>%
filter(partido_asgn == "pan_prd_pri")
asig %>%
filter(partido_asgn == "pan_prd_pri") %>%
pull(id_end_dist)
asig %>%
filter(partido_asgn == "pan_prd_pri") %>%
pull(id_end_dist) %in%dto_fcm
asig %>%
filter(partido_asgn == "pan_prd_pri") %>%
pull(id_end_dist) %>%
.[. %in% dto_fcm]
asig %>%
filter(partido_asgn == "pan_prd_pri") %>%
pull(id_end_dist) %>%
.[!. %in% dto_fcm]
View(cat_dip)
## Cargar PREP ------
prep_dip <- read_csv("01_datos_brutos/20240603_2005_PREP/20240603_2005_PREP_DIP_FED/DIP_FED_2024.csv", skip = 5) %>%
clean_names()
asig <- read_xlsx("04_datos_generados/Convenios de coalición - Diputados federales y senado - AYT.xlsx",
skip = 1) %>%
clean_names() %>%
pivot_longer(c(asignacion_coalicion_shh_morena_pt_pvem,
asignacion_fcm),
names_to = "partido_asgn",
values_to = "partido_coal") %>%
transmute(id_end_dist = paste0(ent_to_id(estado), sprintf("%03d", distrito)),
partido_asgn = case_match(partido_asgn,
"asignacion_coalicion_shh_morena_pt_pvem" ~ "pvem_pt_morena",
"asignacion_fcm" ~ "pan_prd_pri"),
partido_coal) %>%
filter(!is.na(partido_coal))
dto_shh <- candi_dip %>%
filter(partido_ci == "pvem_pt_morena") %>%
pull(id_end_dist)
dto_fcm <- candi_dip %>%
filter(partido_ci == "pan_prd_pri") %>%
pull(id_end_dist)
asig %>%
filter(partido_asgn == "pan_prd_pri") %>%
pull(id_end_dist) %>%
.[!. %in% dto_fcm]
sum_dist <- prep_dip %>%
# Remover votos no contados para MR
filter(tipo_acta != "4ERP",
contabilizada == 1) %>%
# Seleccionar datos importantes
select(clave_casilla,
id_entidad, entidad,
id_distrito_federal, distrito_federal,
pan:total_votos_asentado) %>%
# Crear claves de match
mutate(id_entidad = sprintf("%02d", id_entidad),
id_end_dist = paste0(id_entidad, id_distrito_federal)) %>%
# Hacer colúmna por partido
pivot_longer(pan:nulos,
names_to = "partido",
values_to = "votos") %>%
# Aglutinar votos por partido
mutate(partido_asgn = case_when(str_detect(partido,
"morena|pt|pvem") &
id_end_dist %in% dto_shh ~ "pvem_pt_morena",
str_detect(partido,
"pan|pri|prd") &
id_end_dist %in% dto_fcm ~ "pan_prd_pri",
T ~ partido),
votos = as.numeric(votos),
total_votos_asentado = as.numeric(total_votos_asentado)) %>%
# group_by(id_entidad, id_distrito_federal) %>%
left_join(asig,
join_by(id_end_dist, partido_asgn)) %>%
mutate(partido_coal = ifelse(is.na(partido_coal),
str_to_upper(partido_asgn), str_to_upper(partido_coal))) %>%
group_by(partido_coal) %>%
summarise(total_votos_asentado = first(total_votos_asentado, na_rm = T),
votos = sum(as.numeric(votos), na.rm = T)) %>%
adorn_totals()
View(sum_dist)
dto_fcm %>%
.[!. %in% asig %>%
filter(partido_asgn == "pan_prd_pri") %>%
pull(id_end_dist)]
dto_fcm
(asig %>%
filter(partido_asgn == "pan_prd_pri") %>%
pull(id_end_dist))
(asig %>%
filter(partido_asgn == "pan_prd_pri") %>%
pull(id_end_dist))
o_fcm[!dto_fcm %in% (asig %>%
filter(partido_asgn == "pan_prd_pri") %>%
pull(id_end_dist))]
dto_fcm[!dto_fcm %in% (asig %>%
filter(partido_asgn == "pan_prd_pri") %>%
pull(id_end_dist))]
sum_dist <- prep_dip %>%
# Remover votos no contados para MR
filter(tipo_acta != "4ERP",
contabilizada == 1) %>%
# Seleccionar datos importantes
select(clave_casilla,
id_entidad, entidad,
id_distrito_federal, distrito_federal,
pan:total_votos_asentado) %>%
# Crear claves de match
mutate(id_entidad = sprintf("%02d", id_entidad),
id_end_dist = paste0(id_entidad, id_distrito_federal)) %>%
# Hacer colúmna por partido
pivot_longer(pan:nulos,
names_to = "partido",
values_to = "votos") %>%
# Aglutinar votos por partido
mutate(partido_asgn = case_when(str_detect(partido,
"morena|pt|pvem") &
id_end_dist %in% dto_shh ~ "pvem_pt_morena",
str_detect(partido,
"pan|pri|prd") &
id_end_dist %in% dto_fcm ~ "pan_prd_pri",
T ~ partido),
votos = as.numeric(votos),
total_votos_asentado = as.numeric(total_votos_asentado)) %>%
# group_by(id_entidad, id_distrito_federal) %>%
left_join(asig,
join_by(id_end_dist, partido_asgn)) %>%
mutate(partido_coal = ifelse(is.na(partido_coal),
str_to_upper(partido_asgn), str_to_upper(partido_coal))) %>%
group_by(partido_coal) %>%
summarise(total_votos_asentado = first(total_votos_asentado, na_rm = T),
votos = sum(as.numeric(votos), na.rm = T)) %>%
adorn_totals()
sum_dist
sum_dist <- prep_dip %>%
# Remover votos no contados para MR
filter(tipo_acta != "4ERP",
contabilizada == 1) %>%
# Seleccionar datos importantes
select(clave_casilla,
id_entidad, entidad,
id_distrito_federal, distrito_federal,
pan:total_votos_asentado) %>%
# Crear claves de match
mutate(id_entidad = sprintf("%02d", id_entidad),
id_end_dist = paste0(id_entidad, id_distrito_federal)) %>%
# Hacer colúmna por partido
pivot_longer(pan:nulos,
names_to = "partido",
values_to = "votos") %>%
# Aglutinar votos por partido
mutate(partido_asgn = case_when(str_detect(partido,
"morena|pt|pvem") &
id_end_dist %in% dto_shh ~ "pvem_pt_morena",
str_detect(partido,
"pan|pri|prd") &
id_end_dist %in% dto_fcm ~ "pan_prd_pri",
T ~ partido),
votos = as.numeric(votos),
total_votos_asentado = as.numeric(total_votos_asentado)) %>%
# group_by(id_entidad, id_distrito_federal) %>%
left_join(asig,
join_by(id_end_dist, partido_asgn)) %>%
mutate(partido_coal = ifelse(is.na(partido_coal),
str_to_upper(partido_asgn), str_to_upper(partido_coal))) %>%
group_by(id_end_dist, partido_asgn, partido_coal) %>%
summarise(total_votos_asentado = first(total_votos_asentado, na_rm = T),
votos = sum(as.numeric(votos), na.rm = T))
View(sum_dist)
sum_dist %>%
sum_dist %>%
group_by(id_end_dist) %>%
top_n(1, votos)
sum_dist
sum_dist %>%
group_by(id_end_dist)
sum_dist %>%
group_by(id_end_dist) %>%
top_n(1, votos)
sum_dist %>%
group_by(id_end_dist) %>%
top_n(1, votos) %>%
count(partido_coal)
sum_dist %>%
group_by(id_end_dist) %>%
top_n(1, votos) %>%
ungroup() %>%
count(partido_coal)
sum_dist %>%
group_by(id_end_dist) %>%
top_n(1, votos) %>%
ungroup() %>%
count(partido_coal,
sort = T)
